# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

# Решение для обеспечения процесса разработки (SCM + CI/CD)

## Лучшее решение
**GitLab cloud (GitLab.com) + GitLab CI/CD + self-hosted GitLab Runner**

Облачная платформа, объединяющая систему контроля версий, непрерывную интеграцию и поставку. Решение позволяет централизованно управлять процессом разработки микросервисов и при этом выполнять сборки и тесты на собственной инфраструктуре компании.

#### Архитектура решения

- **GitLab (cloud)**  
  Используется для хранения Git-репозиториев (один репозиторий — один микросервис), управления merge request, пайплайнами CI/CD, шаблонами сборок и секретами.

- **GitLab CI/CD**  
  Отвечает за автоматический запуск сборок и тестов по событиям из системы контроля версий, а также за ручной запуск пайплайнов с параметрами. Поддерживает многостадийные и параллельные пайплайны.

- **GitLab Runner (self-hosted)**  
  Разворачивается на собственных серверах или в Kubernetes-кластере компании и выполняет сборки в Docker-контейнерах с использованием кастомных образов.


#### Соответствие требованиям

- Облачная система — используется GitLab SaaS  
- Система контроля версий Git  
- Отдельный репозиторий для каждого микросервиса  
- Запуск сборок по событиям (push, merge request, tag)  
- Ручной запуск сборок с указанием параметров  
- Индивидуальные настройки и переменные для каждой сборки  
- Поддержка шаблонов и переиспользуемых конфигураций пайплайнов  
- Безопасное хранение секретных данных  
- Несколько конфигураций сборки из одного репозитория  
- Возможность добавления кастомных шагов сборки  
- Использование собственных Docker-образов для сборки  
- Развёртывание агентов сборки на собственных серверах  
- Параллельный запуск нескольких сборок  
- Параллельный запуск тестов  

#### Обоснование выбора

GitLab предоставляет единую экосистему для DevOps-процессов, что снижает сложность сопровождения и интеграции инструментов. Платформа хорошо масштабируется под микросервисную архитектуру, позволяет стандартизировать CI/CD через шаблоны и обеспечивает безопасную работу с секретами. Использование self-hosted runner-ов даёт контроль над ресурсами и повышает безопасность.

#### Итог

GitLab SaaS в сочетании с GitLab CI/CD и self-hosted GitLab Runner является универсальным и масштабируемым решением, полностью удовлетворяющим требованиям к организации процесса разработки и эксплуатации микросервисов в крупной компании.


## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

## Задача 4: Логи * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, пишут логи в stdout. 

Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов, обеспечивающих работу API.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Kibana.
Логин в Kibana должен быть admin, пароль qwerty123456.


## Задача 5: Мониторинг * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, предоставляют набор метрик в формате prometheus:

- сервис security по адресу /metrics,
- сервис uploader по адресу /metrics,
- сервис storage (minio) по адресу /minio/v2/metrics/cluster.

Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов, обеспечивающих работу API.
Построить в Graphana dashboard, показывающий распределение запросов по сервисам.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin, пароль qwerty123456.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
